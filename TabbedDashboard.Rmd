---
title: "Eau Claire COVID"
#author:  "by Jessica Kraker, ____"
date:  "as of `r format(Sys.time()-0*86400, '%B %d, %Y')`"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
    social: menu
    source_code:  https://github.com/jjkraker/EauClaireCOVIDsummary
    theme: spacelab
---

```{r setup, include=FALSE}
library(flexdashboard)
library(knitr)
library(dplyr)
library(ggplot2)
library(ggformula)
library(kableExtra)
library(tidyverse)
library(lubridate)
library(scales)
library(zoo)

source("PlottingFunctions.R")

WIdata = read.csv("Data/WIdata.csv")
# names(WIdata)  
WIdata <- CaseCheck(WIdata)

ECdata = read.csv("Data/ECdata.csv")
# names(ECdata)  
ECdata <- CaseCheck(ECdata)

```

Daily  {data-orientation=columns}
=====================================  
    
Column {.tabset}
-------------------------------------
Important dates (purple dashed lines):

   * May 14:  First day after Stay-at-Home order reversed by state Supreme Court
   * May 25:  Memorial Day (typical celebrations and/or vacations)
   * July 4:  Independence Day (typical celebrations and/or vacations)

(green dashed lines):

   * March 25:  Stay-at-Home order put in place
   * Aug 1:  WI mask mandate in effect

### Eau Claire

   
**Note**:  due to lag time between exposure and final positive test, effects of changes are typically observed about two weeks after event.

```{r,fig.height=3}
DailyCases(ECdata, "Eau Claire") 

```   

### Wisconsin

```{r,fig.height=3}
DailyCases(WIdata, "Wisconsin") 

```   

**Comment:** Why a 7-day moving average?  Wisconsin tends to have cyclical patterns in testing results, with low spots typically on Mondays (this may be due to lower testing on weekends)





Active {.tabset}
-------------------------------------
**Active cases**:  Estimated recovery time from health experts varies between 10-20 days, with rare cases being long-term / on-going.  Even given the testing lag, a conservative approximation is to use the total number of positive (diagnosed) cases across the last 10 days.  We will go with this standard, along with a range from 8-12 days of active accumulation, and adjust as more precise information becomes available.
   
### Eau Claire

```{r,fig.height=3}
ActiveCases(ECdata, "Eau Claire") 

```   

### Wisconsin

```{r,fig.height=3}
ActiveCases(WIdata, "Wisconsin") 


```


Cumulative {data-orientation=columns}
=====================================     

Column {.tabset}
-------------------------------------
   
### Eau Claire
```{r}
PartialTotalTable(ECdata, "Eau Claire")
```

### Wisconsin {data-width=300}

```{r}
PartialTotalTable(WIdata, "Wisconsin")
```




```{r}
```

Column {.tabset}
-------------------------------------

**Definitions**

*Case fatality rate*:

### Wisconsin {data-width=300}

Other information:

   * [Reopening guidelines](https://www.dhs.wisconsin.gov/covid-19/prepare.htm#:~:text=Back%20Section%20Menu-,COVID-19:%20Badger%20Bounce%20Back,safest%20way%20to%20open%20Wisconsin.)
   * [Wisconsin Health Department's comprehensive website on COVID and planning](https://www.dhs.wisconsin.gov/outbreaks/index.htm)
   * [Visual summary of Wisconsin Demographics](https://naccho.maps.arcgis.com/apps/opsdashboard/index.html#/dc74772707d94db9a7d24d30ffdcf36c)

```{r}
```


### Eau Claire

   * [Eau Claire Reopening guidelines "Respond Together"](https://www.eauclairewi.gov/Home/ShowDocument?id=32685)
   * [Eau Claire County Health Department's comprehensive website on COVID and planning](https://coronavirus-and-covid-19-information-hub-eccounty.hub.arcgis.com/)
   * [Visual summary Eau Claire County Demographics](https://naccho.maps.arcgis.com/apps/opsdashboard/index.html#/dc74772707d94db9a7d24d30ffdcf36c)

```{r}
```




References {data-orientation=rows}
=====================================     


Column {data-height=100}
-------------------------------------
    
### Data Sources {data-width=200}

   * [Wisconsin Department of Health Services](https://data.dhsgis.wi.gov/datasets/covid-19-historical-data-table/data?where=GEO%20%3D%20%27State%27) with [variable definitions](https://www.dhs.wisconsin.gov/publications/p02677.pdf)
   * [Eau Claire County statistics]( https://coronavirus-and-covid-19-information-hub-eccounty.hub.arcgis.com/)

### Reliable Updated Visuals {data-width=300}

   * Johns Hopkins dashboard (world, national, and county levels)
   * National
   * https://topic.newsbreak.com/covid-19.html?zip=19934&s=dmg_local_briefing.web2

   * [Wisconsin DHS website](https://www.dhs.wisconsin.gov/covid-19/county.htm), with interactive graphs; subsettable by county
   * [Re-opening Trends](https://www.nytimes.com/interactive/2020/07/09/us/coronavirus-cases-reopening-trends.html):  that is, why didn't the first wave end?

   
   
Column {data-height=400}
-------------------------------------

###  Visual and code references for selected plots {data-width=200}

*I devised plots that are similar to those found, for example, at the following locations:*

   * [Github repository by coolbaby0208](https://github.com/coolbaby0208/MN-COVID19)
   * Covid Act Now https://covidactnow.org/?s=58173
   * A regional breakdown of the United States COVID-19 curve https://www.reddit.com/r/dataisbeautiful/comments/heglc5/oc_a_regional_breakdown_of_the_united_states/
   * Minnesota updates from Reddit  https://www.reddit.com/r/minnesota/comments/h9j6pj/covid19_update_up_222_230_by_mdh_active_2780/ and https://www.reddit.com/r/minnesota/comments/hfovhg/625_update_34123_positives_360_1406_deaths_9/
   * [Wisconsin updates](https://www.reddit.com/r/CoronavirusWI/comments/hftc25/62520_graphs/) (from Redditor [unknown-and-alone](https://www.reddit.com/user/unknown-and-alone)) 
   * <a href="https://www.reddit.com/r/CoronavirusWI/comments/hftc25/62520_graphs/" target="_blank">Wisconsin updates</a>
   * https://www.reddit.com/r/dataisbeautiful/comments/hjwthw/oc_countylevel_covid19_case_growth_animation_in/
   * https://www.cpp.edu/~clange/covid19/Covid19ReportCaliforniaComp.html

### Scientific References for Common Questions {data-width=500}

[**Asymptomatic Spread**](https://www.pnas.org/content/early/2020/07/02/2008373117)

**Masks** Should I wear a mask in enclosed public spaces?  Unequivocally, **YES**.  References for reasoning, using a current (as of July 8) [accumulation of over 70 references](https://threader.app/thread/1279144399897866248).  A few of my favorites (modeling-wise) are:

   * [Physical distancing, face masks, and eye protection to prevent person-to-person transmission of SARS-CoV-2 and COVID-19: a systematic review and meta-analysis](https://www.thelancet.com/journals/lancet/article/PIIS0140-6736(20)31142-9/fulltext)
   * [Background for modelling: A modelling framework to assess the likely effectiveness of facemasks in combination with ‘lock-down’ in managing the COVID-19 pandemic](https://royalsocietypublishing.org/doi/10.1098/rspa.2020.0376)
   * [To mask or not to mask: Modeling the potential for face mask use by the general public to curtail the COVID-19 pandemic](https://www.sciencedirect.com/science/article/pii/S2468042720300117?via%3Dihub)
   * [Face Masks Considerably Reduce COVID-19 Cases in Germany: A Synthetic Control Method Approach](http://ftp.iza.org/dp13319.pdf?fbclid=IwAR1jlcs2PjDIvg3AjqxMucwVPfexpxRDOt5T3k24MzNYmTCIE0Resziaeto)

   
A couple more in the works:

   * [Face mask wearing rate predicts country's COVID-19 death rates]( https://www.medrxiv.org/content/10.1101/2020.06.22.20137745v1)
   * [Association of country-wide coronavirus mortality with demographics, testing, lockdowns, and public wearing of masks (Update June 15, 2020)]( https://www.researchgate.net/publication/342198360_Association_of_country-wide_coronavirus_mortality_with_demographics_testing_lockdowns_and_public_wearing_of_masks_Update_June_15_2020)
   * [Physical distancing, face masks, and eye protection for prevention of COVID-19](https://www.thelancet.com/journals/lancet/article/PIIS0140-6736(20)31183-1/fulltext?fbclid=IwAR0TSoh6w_Pl54K5ZmmNU6p_cIBo2EoP9BmSxY5Pu2K0aV95IPwk5T53Q6s)

Media articles / letters summarizing scientific publications:

   * [Petition from Minnesota Healthcare Clinicians](https://docs.google.com/forms/d/e/1FAIpQLSel_CEtyTqFjyv_XFFyhPwbH-J6gnfX0YWsiEqlBLE4bsOHGg/viewform?fbclid=IwAR2QaUjDigeGZpGDS0mszJVXqiF4OqBCLlW_9hc7pApBv4WjDlIX1ToXlV4) to Gov. Walz, submitted July 7 with 1600 signatures
   * https://www.npr.org/sections/health-shots/2020/06/21/880832213/yes-wearing-masks-helps-heres-why
   * https://www.sfgate.com/science/article/Study-100-face-mask-use-could-crush-second-15333170.php?

Modeling  {data-orientation=rows}
=====================================     


```{r}
n=dim(WIdata)[1]; start = 18 # error on neg cases at 17
allcorPOS = c()
for (k in 1:24) {
  allcorPOS = c(allcorPOS,
                (cor(log(WIdata$POSITIVE[start:(n-k)]),
                     log(WIdata$DEATHS[(k+start):n])
                     )
                 )
                )
#  plot(log(WIdata$POSITIVE[start:(n-k)]),log(WIdata$DEATHS[(k+start):n]))
}
#plot(1:24,allcorPOS)

kLogPOS = order(allcorPOS)[24]

allcorRateNEW = c()
for (k in 1:25) {
  TestsNEW = WIdata$POS_NEW[start:(n-k)]+WIdata$NEG_NEW[start:(n-k)]
  RateNEW = WIdata$POS_NEW[start:(n-k)]/TestsNEW
  allcorRateNEW = c(allcorRateNEW,
                (cor(RateNEW,
                     log(WIdata$DEATHS[(k+start):n])
                     )
                 )
                )
#  plot(RateNEW,log(WIdata$DEATHS[(k+start):n]))
}
#plot(1:25,allcorRateNEW)
kRatePOS = order(allcorRateNEW)[1]
        
k=20; 
plot(log(WIdata$POSITIVE[start:(n-k)]),log(WIdata$DEATHS[(k+start):n]), 
     col="#00CED1", type="l", lwd=2,
     xlab="log Cumulative Cases",
     ylab=paste("log Deaths at lag",k)
)

TestsNEW = WIdata$POS_NEW[start:(n-k)]+WIdata$NEG_NEW[start:(n-k)]
RateNEW = WIdata$POS_NEW[start:(n-k)]/TestsNEW
#plot(RateNEW,log(WIdata$DEATHS[(k+start):n]),
#     col="#00CED1", lwd=2,
#     xlab="New Positives (daily) rate",
#     ylab=paste("log Deaths at lag",k)
#)
coef = lm(log(WIdata$DEATHS[(k+start):n])~log(WIdata$POSITIVE[start:(n-k)]))$coef
abline(coef)
print(paste("The number of  cumulative deaths, at a lag of", k, "days, are approximately", round(as.numeric(exp(coef[1])),1), "times number of cumulative cases to the", round(as.numeric(coef[2]),2), "power."))
print(paste("We thus predict that on", today()+k, "the cumulative number of deaths in WI will be", round(exp(coef[1])*(max(WIdata$POSITIVE))^coef[2])))
```
